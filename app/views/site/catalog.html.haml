%h1 Courses
%table#courses.table.table-striped.table-bordered
  %thead
    %th.id ID
    %th.name
      Name
      .icons
        = link_to 'javascript:void(0)' do
          %i.icon-chevron-up.top
        = link_to 'javascript:void(0)' do
          %i.icon-chevron-down.bottom
    %th.range Range
    %th.location
      Location
      .icons
        = link_to 'javascript:void(0)' do
          %i.icon-chevron-up.top
        = link_to 'javascript:void(0)' do
          %i.icon-chevron-down.bottom
    %th.dates
      Dates
      .icons
        = link_to 'javascript:void(0)' do
          %i.icon-chevron-up.top
        = link_to 'javascript:void(0)' do
          %i.icon-chevron-down.bottom
    %th.start-time
      Starts
      .icons
        = link_to 'javascript:void(0)' do
          %i.icon-chevron-up.top
        = link_to 'javascript:void(0)' do
          %i.icon-chevron-down.bottom
    %th.end-time
      Ends
      .icons
        = link_to 'javascript:void(0)' do
          %i.icon-chevron-up.top
        = link_to 'javascript:void(0)' do
          %i.icon-chevron-down.bottom
    - if organization.admins.include?(current_user)
      %th.admin
        Admin
  %tbody
    - if current_user && current_user.admin_organizations.include?(organization)
      - courses = organization.courses.mirai.reorder(:created_at)
    - else
      - courses = organization.courses.mirai.published.reorder(:created_at)
    - courses.each do |course|
      %tr{cid: course.id, lowname: course.lowname, id: "course#{course.id}"}
        %td= course.id
        %td= course.name
        - if course.start_range
          %td= course.range_type + 's ' + course.start_range.to_s + ' - ' + course.end_range.to_s
        - else
          %td any
        %td= course.location_name
        %td{date: "#{course.days.reorder(:date).first.date.to_time.to_i}"}= course.date_string
        %td= course.default_start.to_time.strftime('%l:%M %p')
        %td= course.default_end.to_time.strftime('%l:%M %p')
        - if organization.admins.include?(current_user)
          %td.admin
            = link_to "/admin/courses/#{course.id}" do
              %i.icon-cog
            = link_to "/courses/#{course.id}/#{course.lowname}/download" do
              %i.icon-file
            = link_to "/courses/#{course.id}/#{course.lowname}/destroy?id=#{course.id}", remote: true do
              %i.icon-trash

:javascript
  $('tbody tr > :not(.admin)').click(function(){
    window.location = '/courses/' + $(this).parent().attr('cid') + '/' + $(this).parent().attr('lowname')
  })
  $.tablesorter.addParser({
    id: 'dates',
    is: function(s){return false},
    type: 'numeric',
    format: function(s,t,c) {
      return $(c).attr('date')
    }
  })
  $('#courses').tablesorter({
    headers: {
      3: { sorter: 'dates' }
    }
  })
